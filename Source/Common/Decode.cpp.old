
/* The reason for the rather bizarre way of defining this method - via the
#include in the .h file - is because it's part of several derived classes, and
FnMapx and this are different in each derived class, and I can't find a way
of doing this without breaking syntax. Rather, I can and have, and this is it,
but I really, really don't like it.

Perfection is the enemy of progress, and all that. This works.

DON'T PUT ANY #include IN THIS FILE

It's virtual here because this makes it an invalid translation unit, so if you
try to compile it, the compiler will squeak.
*/

//==============================================================================

virtual unsigned Decode(PMsg_p * pPkt)
// Routine to decode - that is, send to the correct handler - incoming messages
// Look at the message key, and use the map to call the appropriate (derived
// class) member. If it's not in the derived class map, try the base class map.
// If it's not there either, it gets junked.
{
//printf("%s::Decode ",Sderived.c_str());
                                       // Handler in the derived class?
if (FnMapx.find(pPkt->Key())!=FnMapx.end()) {
//  printf(".. derived\n"); fflush(stdout);
  return (this->*FnMapx[pPkt->Key()])(pPkt);
}
                                       // Nope. Base class?
if (CommonBase::FnMapx.find(pPkt->Key())!=CommonBase::FnMapx.end()) {
//  printf(".. base\n"); fflush(stdout);
  return (this->*CommonBase::FnMapx[pPkt->Key()])(pPkt);
}
//printf(".. dropped\n"); fflush(stdout);
                                       // Nope. Kick.
                                       // Pull out the unknown key and post what
                                       // little we know to the LogServer
Post(101,Sderived,pPmap->Name(pPkt->Src()),int2str(pPkt->Src()),
                  pPmap->Name(pPkt->Tgt()),int2str(pPkt->Tgt()),
                  hex2str(pPkt->Key()));

return 0;                              // Return "keep going" value
}

//==============================================================================




